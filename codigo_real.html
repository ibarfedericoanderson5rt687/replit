{% extends 'base.html' %}

{% block title %}C贸digo QRGB - Python{% endblock %}

{% block content %}
<div class="row mb-5">
    <div class="col-lg-8 mx-auto text-center">
        <h1 class="display-5 fw-bold mb-4">C贸digo de la App QRGB</h1>
        <p class="lead">Script Python desarrollado con asistencia de Claude Sonnet 3.5</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-lg-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h2 class="card-title h4 mb-3">Descripci贸n del proyecto</h2>
                <p>Esta aplicaci贸n, desarrollada por el Ph.D. Ibar Federico Anderson con asistencia de la IA de Replit, permite generar c贸digos QR con colores personalizados. Utiliza las bibliotecas Kivy para la interfaz gr谩fica, PIL para manipulaci贸n de im谩genes y qrcode para la generaci贸n de c贸digos QR.</p>
                <p>El c贸digo est谩 disponible como Open Source y puede ser adaptado para ejecutarse localmente en tu entorno de desarrollo.</p>
                
                <div class="alert alert-info">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle fa-2x me-3"></i>
                        </div>
                        <div>
                            <h4 class="alert-heading">Enlaces del proyecto</h4>
                            <p>Explora el proyecto completo en los siguientes enlaces:</p>
                            <div class="d-grid gap-3">
                                <a href="https://github.com/ibarfedericoanderson" class="btn btn-primary" target="_blank" style="background-color: #24292e; border-color: #24292e;">
                                    <i class="fab fa-github me-2"></i><strong>Perfil del Autor en GitHub</strong>
                                </a>
                                <a href="{{ url_for('descargar_proyecto_completo') }}" class="btn btn-success" download style="background-color: #F26207; border-color: #F26207;">
                                    <i class="fas fa-download me-2"></i><strong>Descargar proyecto completo (ZIP)</strong>
                                </a>
                                <a href="https://appqrgbpythonappapp-kz8zenrno2ybehz4zgkccc.streamlit.app/" class="btn text-white" target="_blank" style="background-color: #FF4B4B; border-color: #FF4B4B;">
                                    <i class="fas fa-cloud-upload-alt me-2"></i><strong>Versi贸n web en Streamlit Cloud</strong>
                                </a>
                                <a href="{{ url_for('version_web') }}" class="btn" style="background-color: #F7DF1E; border-color: #F7DF1E; color: #000;">
                                    <i class="fas fa-globe me-2"></i><strong>Versi贸n para GitHub Pages</strong>
                                </a>
                            </div>
                            <hr class="my-3">
                            <p>Enlaces adicionales:</p>
                            <ul class="list-group">
                                <li class="list-group-item bg-transparent border-0 ps-0">
                                    <i class="fas fa-external-link-alt me-2 text-primary"></i>
                                    <a href="https://federicoandersonar.wixsite.com/app-qrgb" class="text-decoration-none" target="_blank">Sitio web con informaci贸n sobre la App</a>
                                </li>
                                <li class="list-group-item bg-transparent border-0 ps-0">
                                    <i class="fab fa-github me-2 text-dark"></i>
                                    <a href="https://github.com/ibarfedericoanderson/ScriptPythonAppQRGB" class="text-decoration-none" target="_blank">Repositorio del proyecto en GitHub</a>
                                </li>
                                <li class="list-group-item bg-transparent border-0 ps-0">
                                    <i class="fas fa-code me-2 text-warning"></i>
                                    <a href="https://github.com/ibarfedericoanderson/ScriptPythonAppQRGB/blob/main/QRGB.py" class="text-decoration-none" target="_blank">Ver script Python en GitHub</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-lg-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h2 class="card-title h4 mb-3">C贸digo fuente</h2>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0"><i class="fas fa-code text-warning me-2"></i>C贸digo fuente de QRGB con Kivy</h3>
                    <div>
                        <a href="{{ url_for('static', filename='QRGB.py') }}" download class="btn btn-sm btn-primary">
                            <i class="fas fa-download me-1"></i> Descargar Python
                        </a>
                    </div>
                </div>
                
                <div style="border-radius: 5px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <!-- Barra superior estilo Carbon/VSCode -->
                    <div style="background-color: #252525; padding: 8px 16px; border-top-left-radius: 5px; border-top-right-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center;">
                            <span style="display: inline-block; width: 12px; height: 12px; background-color: #FF5F56; border-radius: 50%; margin-right: 8px;"></span>
                            <span style="display: inline-block; width: 12px; height: 12px; background-color: #FFBD2E; border-radius: 50%; margin-right: 8px;"></span>
                            <span style="display: inline-block; width: 12px; height: 12px; background-color: #27C93F; border-radius: 50%; margin-right: 8px;"></span>
                            <span style="color: #eee; font-size: 14px; margin-left: 12px;">QRGB.py</span>
                        </div>
                        <div>
                            <span style="color: #888; font-size: 12px;">Python</span>
                        </div>
                    </div>
                    
                    <!-- Contenido del c贸digo con estilo Carbon/VSCode - Versi贸n simplificada -->
                    <div style="background-color: #1E1E1E; color: #D4D4D4; font-family: 'Fira Code', monospace; padding: 16px; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; overflow-x: auto; line-height: 1.5;">
<pre style="margin: 0; line-height: 1.5; background: transparent; border: none; color: inherit; padding: 0;"><code style="display: block; white-space: pre;">
from kivy.app import App
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.label import Label
from kivy.uix.button import Button
from kivy.uix.textinput import TextInput
from kivy.uix.image import Image as KivyImage
from kivy.core.window import Window
from kivy.uix.popup import Popup
from kivy.uix.filechooser import FileChooserIconView
from kivy.uix.widget import Widget
from PIL import Image
import qrcode
import os
import cv2
import webbrowser
import logging
import sys
from pathlib import Path

# Obtener la ruta base del ejecutable o script
if getattr(sys, 'frozen', False):
    # Si es un ejecutable
    BASE_PATH = os.path.dirname(sys.executable)
else:
    # Si es el script Python
    BASE_PATH = os.path.dirname(os.path.abspath(__file__))

# Configurar carpetas
FOLDER_PATH = os.path.join(BASE_PATH, 'qrgb_files')
LOG_PATH = os.path.join(FOLDER_PATH, 'qrgb.log')

# Crear directorios necesarios
os.makedirs(FOLDER_PATH, exist_ok=True)

# Configuraci贸n de logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler(LOG_PATH),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

def create_qr_with_logo(data, color, logo_path, qr_version=10, box_size=10):
    qr = qrcode.QRCode(
        version=qr_version,
        error_correction=qrcode.constants.ERROR_CORRECT_H,
        box_size=box_size,
        border=4
    )
    qr.add_data(data)
    qr.make(fit=True)

    img = qr.make_image(fill_color=color, back_color="white").convert('RGBA')
    
    if not os.path.exists(logo_path):
        raise FileNotFoundError(f"Logo file not found: {logo_path}")

    logo = Image.open(logo_path).convert("RGBA")
    basewidth = img.size[0] // 4
    wpercent = (basewidth / float(logo.size[0]))
    hsize = int((float(logo.size[1]) * float(wpercent)))
    logo = logo.resize((basewidth, hsize), Image.LANCZOS)

    pos = ((img.size[0] - logo.size[0]) // 2, (img.size[1] - logo.size[1]) // 2)
    img.paste(logo, pos, logo)

    return img

def combine_qr_images(img1, img2, img3, logo_path):
    size = img1.size
    if img2.size != size or img3.size != size:
        raise ValueError("All QR images must be the same size")

    final_image = Image.new("RGBA", size, "black")

    data_red = img1.getdata()
    data_green = img2.getdata()
    data_blue = img3.getdata()

    new_data = []
    for i in range(len(data_red)):
        r1, g1, b1, a1 = data_red[i]
        red_pixel = (r1, g1, b1) != (255, 255, 255)
        r2, g2, b2, a2 = data_green[i]
        green_pixel = (r2, g2, b2) != (255, 255, 255)
        r3, g3, b3, a3 = data_blue[i]
        blue_pixel = (r3, g3, b3) != (255, 255, 255)

        if red_pixel and green_pixel and blue_pixel:
            new_data.append((255, 255, 255, 255))
        elif red_pixel and green_pixel:
            new_data.append((255, 255, 0, 255))
        elif red_pixel and blue_pixel:
            new_data.append((255, 0, 255, 255))
        elif green_pixel and blue_pixel:
            new_data.append((0, 255, 255, 255))
        elif red_pixel:
            new_data.append((255, 0, 0, 255))
        elif green_pixel:
            new_data.append((0, 255, 0, 255))
        elif blue_pixel:
            new_data.append((0, 0, 255, 255))
        else:
            new_data.append((0, 0, 0, 255))

    final_image.putdata(new_data)

    # Aplicar logo al QR final
    logo = Image.open(logo_path).convert("RGBA")
    basewidth = final_image.size[0] // 4
    wpercent = (basewidth / float(logo.size[0]))
    hsize = int((float(logo.size[1]) * float(wpercent)))
    logo = logo.resize((basewidth, hsize), Image.LANCZOS)

    pos = ((final_image.size[0] - logo.size[0]) // 2, (final_image.size[1] - logo.size[1]) // 2)
    final_image.paste(logo, pos, logo)

    return final_image

class MainMenu(BoxLayout):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.orientation = 'vertical'
        self.padding = 10
        self.spacing = 10
        self.setup_ui()

class QRGBApp(App):
    def build(self):
        return MainMenu()

if __name__ == "__main__":
    QRGBApp().run()
</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-lg-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h2 class="card-title h4 mb-3">Instrucciones para ejecutar localmente en VSCode</h2>
                
                <div class="mb-4">
                    <h5>Requisitos previos</h5>
                    <ol>
                        <li>Tener Python instalado (versi贸n 3.7 o superior)</li>
                        <li>Tener VSCode instalado con la extensi贸n de Python</li>
                    </ol>
                </div>
                
                <div class="mb-4">
                    <h5>Instalaci贸n de dependencias</h5>
                    <p>Ejecuta el siguiente comando en la terminal de VSCode para instalar las bibliotecas necesarias:</p>
                    <div class="bg-dark p-3 rounded">
                        <pre class="text-light mb-0"><code>pip install kivy pillow qrcode opencv-python</code></pre>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h5>Pasos para ejecutar</h5>
                    <ol>
                        <li>Descarga el c贸digo desde el <a href="https://github.com/ibarfedericoanderson/ScriptPythonAppQRGB/blob/main/QRGB.py" target="_blank">repositorio en GitHub</a></li>
                        <li>Abre VSCode y carga el archivo descargado</li>
                        <li>Abre una terminal en VSCode (Terminal > New Terminal)</li>
                        <li>Ejecuta el script con el comando: <code>python QRGB.py</code></li>
                    </ol>
                </div>
                
                <div class="alert alert-info">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle fa-2x me-3"></i>
                        </div>
                        <div>
                            <h4 class="alert-heading">Desarrollado con Replit y Claude</h4>
                            <p>Este c贸digo fue desarrollado con la asistencia de Claude Sonnet 3.5 en la plataforma Replit. A trav茅s de conversaciones interactivas, la IA ayud贸 a estructurar el c贸digo, implementar algoritmos para manipular las capas RGB de los c贸digos QR y crear una interfaz gr谩fica utilizando Kivy.</p>
                            <p>Si encuentras problemas con la biblioteca Kivy, considera usar la versi贸n web de la aplicaci贸n en Streamlit Cloud o consulta la documentaci贸n oficial de Kivy para solucionar problemas espec铆ficos de instalaci贸n seg煤n tu sistema operativo.</p>
                            <p class="mb-0">Tambi茅n puedes adaptar el c贸digo para usar otra biblioteca de interfaz gr谩fica como tkinter, que viene preinstalada con Python.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-lg-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <h2 class="card-title h4 mb-3">Versi贸n Streamlit (m谩s sencilla de ejecutar)</h2>
                <p>Si prefieres una versi贸n m谩s f谩cil de ejecutar localmente, puedes usar la versi贸n Streamlit de la aplicaci贸n.</p>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0"><i class="fas fa-stream text-danger me-2"></i>Script para Streamlit</h3>
                    <div>
                        <a href="{{ url_for('descargar_streamlit') }}" download class="btn btn-sm btn-danger">
                            <i class="fas fa-download me-1"></i> Descargar Script Streamlit
                        </a>
                    </div>
                </div>
                
                <div style="border-radius: 5px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                    <!-- Barra superior estilo Carbon/VSCode -->
                    <div style="background-color: #252525; padding: 8px 16px; border-top-left-radius: 5px; border-top-right-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center;">
                            <span style="display: inline-block; width: 12px; height: 12px; background-color: #FF5F56; border-radius: 50%; margin-right: 8px;"></span>
                            <span style="display: inline-block; width: 12px; height: 12px; background-color: #FFBD2E; border-radius: 50%; margin-right: 8px;"></span>
                            <span style="display: inline-block; width: 12px; height: 12px; background-color: #27C93F; border-radius: 50%; margin-right: 8px;"></span>
                            <span style="color: #eee; font-size: 14px; margin-left: 12px;">app_qrgb_streamlit.py</span>
                        </div>
                        <div>
                            <span style="color: #888; font-size: 12px;">Python</span>
                        </div>
                    </div>
                    
                    <!-- Contenido del c贸digo con estilo Carbon/VSCode - Streamlit -->
                    <div style="background-color: #1E1E1E; color: #D4D4D4; font-family: 'Fira Code', monospace; padding: 16px; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; overflow-x: auto; line-height: 1.5;">
<pre style="margin: 0; line-height: 1.5; background: transparent; border: none; color: inherit; padding: 0;"><code style="display: block; white-space: pre;">
import streamlit as st
import qrcode
from PIL import Image
import io
import base64

st.set_page_config(
    page_title="QRGB - Generador de QR con datos en RGB",
    page_icon="",
    layout="wide"
)

def generar_qr(texto, color_fondo, color_qr):
    qr = qrcode.QRCode(
        version=1,
        error_correction=qrcode.constants.ERROR_CORRECT_H,
        box_size=10,
        border=4,
    )
    qr.add_data(texto)
    qr.make(fit=True)
    
    img = qr.make_image(fill_color=color_qr, back_color=color_fondo)
    return img

def main():
    st.title(" QRGB - Generador de C贸digos QR")
    st.write("### Creado por [Ibar Federico Anderson](https://github.com/ibarfedericoanderson)")
    
    st.markdown("""
    Esta es una versi贸n web simplificada de la aplicaci贸n QRGB.
    Permite generar c贸digos QR personalizados con diferentes colores.
    """)
    
    st.sidebar.header("Configuraci贸n")
    
    # Selector de pesta帽a
    tab_seleccionada = st.sidebar.radio(
        "Selecciona una opci贸n:",
        ["Generador de QR simple", "Acerca de"]
    )
    
    if tab_seleccionada == "Generador de QR simple":
        st.header("Generar c贸digo QR personalizado")
        
        # Entrada de texto
        texto_qr = st.text_area("Ingresa el texto o URL para el c贸digo QR:", height=100)
        
        # Selecci贸n de colores
        col1, col2 = st.columns(2)
        with col1:
            color_qr = st.color_picker("Color del QR:", "#000000")
        with col2:
            color_fondo = st.color_picker("Color de fondo:", "#FFFFFF")
        
        # Bot贸n para generar
        if st.button("Generar QR"):
            if texto_qr:
                with st.spinner("Generando QR..."):
                    img = generar_qr(texto_qr, color_fondo, color_qr)
                    
                    # Mostrar imagen
                    st.image(img, caption="Tu c贸digo QR personalizado", use_column_width=True)
                    
                    # Preparar imagen para descarga
                    buf = io.BytesIO()
                    img.save(buf, format='PNG')
                    byte_im = buf.getvalue()
                    
                    # Bot贸n de descarga
                    btn = st.download_button(
                        label="Descargar QR",
                        data=byte_im,
                        file_name="qr_code.png",
                        mime="image/png"
                    )
            else:
                st.error("Por favor, ingresa alg煤n texto para generar el QR.")
    
    elif tab_seleccionada == "Acerca de":
        st.header("Acerca de QRGB")
        st.markdown("""
        ## Aplicaci贸n QRGB completa
        
        La versi贸n completa de esta aplicaci贸n permite:
        
        - Generar c贸digos QR que contienen 3 mensajes diferentes en las capas RGB
        - Superponer los c贸digos para crear un QR a color
        - A帽adir un logo personalizado al centro del c贸digo QR
        - Leer c贸digos QR RGB para extraer la informaci贸n de cada capa
        
        ## Desarrollador
        
        Dr. Ibar Federico Anderson, Ph.D., Dise帽ador Industrial 
        
        - [Perfil de GitHub](https://github.com/ibarfedericoanderson)
        - [Google Scholar](https://scholar.google.com/citations?user=mXD4RFUAAAAJ&hl=en)
        - [ORCID](https://orcid.org/0000-0002-9732-3660)
        
        ## Tecnolog铆as utilizadas
        
        - Python
        - Streamlit
        - qrcode
        - Pillow (PIL)
        - Claude Sonnet 3.5 en Replit para asistencia en el desarrollo
        """)
        
        st.info("Esta aplicaci贸n fue desarrollada con asistencia de Claude Sonnet 3.5 en la plataforma Replit.")

if __name__ == "__main__":
    main()
</code></pre>
                    </div>
                </div>
                
                <div class="alert alert-success">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-lightbulb fa-2x me-3"></i>
                        </div>
                        <div>
                            <h4 class="alert-heading">Ejecutar la versi贸n Streamlit</h4>
                            <p>Para ejecutar la versi贸n Streamlit localmente, sigue estos pasos:</p>
                            <ol>
                                <li>Instala Streamlit con: <code>pip install streamlit</code></li>
                                <li>Descarga el script y gu谩rdalo como <code>app_qrgb_streamlit.py</code></li> 
                                <li>Abre una terminal y navega hasta la carpeta donde guardaste el archivo</li>
                                <li>Ejecuta: <code>streamlit run app_qrgb_streamlit.py</code></li>
                            </ol>
                            <p class="mb-0">Tu navegador se abrir谩 autom谩ticamente con la aplicaci贸n ejecut谩ndose.</p>
                        </div>
                    </div>
                </div>
                
                <div class="d-grid gap-3 mt-4">
                    <a href="https://appqrgbpythonappapp-kz8zenrno2ybehz4zgkccc.streamlit.app/" class="btn btn-danger btn-lg" target="_blank">
                        <i class="fas fa-external-link-alt me-2"></i> Probar versi贸n desplegada en Streamlit Cloud
                    </a>
                    <a href="{{ url_for('descargar_streamlit') }}" class="btn btn-outline-primary btn-lg" download>
                        <i class="fas fa-download me-2"></i> Descargar script de Streamlit
                    </a>
                    <a href="{{ url_for('version_web') }}" class="btn btn-warning btn-lg">
                        <i class="fas fa-globe me-2"></i> Ver versi贸n web (GitHub Pages)
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-5">
    <div class="col-lg-12 text-center">
        <h2 class="mb-4">Explora m谩s Recursos</h2>
        <div class="d-flex justify-content-center gap-3">
            <a href="{{ url_for('recursos') }}" class="btn btn-lg btn-outline-light px-4">
                <i class="fas fa-book me-2"></i>Recursos de Aprendizaje
            </a>
            <a href="https://github.com/ibarfedericoanderson" class="btn btn-lg btn-primary px-4" target="_blank">
                <i class="fab fa-github me-2"></i>GitHub del Autor
            </a>
        </div>
    </div>
</div>
{% endblock %}